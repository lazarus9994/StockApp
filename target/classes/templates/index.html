<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- ВАЖНО: подаваме 3 параметъра → content, page, scripts -->
<th:block th:replace="~{layout :: layout(~{this :: content}, 'dashboard', ~{this :: scripts})}">

    <section th:fragment="content">

        <h1>Dashboard</h1>

        <!-- RANGE SELECTOR -->
        <div class="range-selector">
            <label>Range:</label>
            <select id="rangeSelect">
                <option value="daily"   th:selected="${currentRange == 'daily'}">Daily</option>
                <option value="weekly"  th:selected="${currentRange == 'weekly'}">Weekly</option>
                <option value="monthly" th:selected="${currentRange == 'monthly'}">Monthly</option>
                <option value="yearly"  th:selected="${currentRange == 'yearly'}">Yearly</option>
                <option value="all"     th:selected="${currentRange == 'all'}">All</option>
            </select>
        </div>

        <!-- MARKET CHART -->
        <div class="card wide">
            <h3>NDAQ Market Overview</h3>
            <canvas id="marketChart"></canvas>
        </div>

        <div class="grid-2">

            <!-- WATCHLIST SECTION -->
            <div class="card">
                <h3>Your Watchlist</h3>

                <div th:if="${#lists.isEmpty(watchlist)}">
                    <p>No items in your watchlist yet.</p>
                </div>

                <ul th:if="${!#lists.isEmpty(watchlist)}">
                    <li th:each="item : ${watchlist}">
                        <a th:href="@{/stocks/{code}(code=${item.stock.stockCode})}">
                            <strong th:text="${item.stock.stockCode}"></strong>
                            <span th:text="${item.stock.stockName}"></span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- NEWS SECTION -->
            <div class="card">
                <h3>Latest News</h3>

                <div th:if="${#lists.isEmpty(news)}">
                    <p>No recent news.</p>
                </div>

                <div class="news-item" th:each="n : ${news}">
                    <h4 th:text="${n.headline}"></h4>
                    <p th:text="${#strings.abbreviate(n.content, 200)}"></p>
                    <a th:href="${n.url}" target="_blank">Read more</a>

                    <div class="published-date"
                         th:text="${#temporals.format(n.publishedAt, 'yyyy-MM-dd HH:mm')}"></div>

                    <small th:text="'Source: ' + ${n.source}"></small>
                </div>
            </div>

        </div>

    </section>

    <!-- PAGE-SPECIFIC SCRIPTS -->
    <th:block th:fragment="scripts">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

        <script th:inline="javascript">
            window.currentRange = [[${currentRange}]];
        </script>

        <script src="/js/indexChart.js"></script>
    </th:block>

</th:block>
</html>
