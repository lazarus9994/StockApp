<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<link rel="stylesheet" th:href="@{/css/watchlist.css}">


<!-- Use main layout with correct parameters -->
<th:block th:replace="~{layout :: layout(~{this :: content}, 'watchlist', ~{this :: scripts})}">

    <!-- ========================= -->
    <!-- CONTENT -->
    <!-- ========================= -->
    <section th:fragment="content" class="dashboard">

        <h1 class="page-title">‚≠ê Your Watchlist</h1>

        <!-- Status messages -->
        <div th:if="${param.added}" class="alert success">
            ‚úÖ Added <strong th:text="${param.added}"></strong> to your watchlist.
        </div>

        <div th:if="${param.removed}" class="alert danger">
            üóë Removed <strong th:text="${param.removed}"></strong> from your watchlist.
        </div>

        <div class="card wide">

            <!-- Add Form -->
            <form th:action="@{/watchlist/add}" method="post" class="watchlist-add-form">
                <select name="code" required>
                    <option value="" disabled selected>Select a stock</option>
                    <option th:each="stock : ${allStocks}"
                            th:value="${stock.stockCode}"
                            th:text="${stock.stockName + ' (' + stock.stockCode + ')'}">
                    </option>
                </select>
                <button type="submit" class="btn btn-primary">‚ûï Add</button>
            </form>

            <!-- Watchlist Table -->
            <table class="watchlist-table">
                <thead>
                <tr>
                    <th>Symbol</th>
                    <th>Name</th>
                    <th class="right">Action</th>
                </tr>
                </thead>

                <tbody>

                <tr th:each="item : ${watchlist}">
                    <td th:text="${item.stock.stockCode}"></td>
                    <td th:text="${item.stock.stockName}"></td>
                    <td class="right">
                        <form th:action="@{/watchlist/remove}" method="post" class="inline-form">
                            <input type="hidden" name="code" th:value="${item.stock.stockCode}">
                            <button type="submit" class="btn danger">üóë Remove</button>
                        </form>
                    </td>
                </tr>

                <tr th:if="${#lists.isEmpty(watchlist)}">
                    <td colspan="3" class="center">
                        Your watchlist is empty.
                    </td>
                </tr>

                </tbody>
            </table>

        </div>

    </section>

    <!-- ========================= -->
    <!-- SCRIPTS -->
    <!-- ========================= -->
    <th:block th:fragment="scripts">
        <script>
            // auto-hide alerts after 3 seconds
            setTimeout(() => {
                document.querySelectorAll('.alert').forEach(el => el.remove());
            }, 3000);
        </script>
    </th:block>

</th:block>

</html>
